# Knurld

The Knurld Ruby SDK is a relatively straight-forward HTTP request wrapper (with some batteries included) built on top of the `Rest-Client` gem.

It is unit tested, and documentation is generated by `yard`.

**NOTE:** While the API technically supports direct file uploads, this is not considered best practice, and this gem relies on externally hosted audio files (dropbox, s3, etc).
## Installation

Add this line to your application's Gemfile:

```ruby
gem 'knurld'
```

And then execute:

    $ bundle

Or install it yourself as:

    $ gem install knurld

## Usage

The Knurld Workflow is preserved. A working example of usage can be seen in `spec/workflow_spec.rb` (copied and reformatted here)

```ruby
#create our consumer with a random username
@consumer = Knurld::Consumer.new({:gender => "male",
                                  :username => ('a'..'z').to_a.shuffle[0,8].join,
                                  :password => "TESTUSER"})

#create our appmodel
@appmodel = Knurld::AppModel.new({:vocabulary => ["Boston", "Ivory", "Sweden"]})

#create an enrollment using the consumer & appmodel
@enrollment = Knurld::Enrollment.new({:consumer => @consumer, :appmodel => @appmodel})

#retrieve the enrollment phrase & number of types to repeat each word
#NOTE: the phrase "boston, ivory" would be repeated as "boston, boston, ivory, ivory
#NOT boston, ivory, boston, ivory"
@phrase = @enrollment.status["phrase"]
@repeats = @enrollment.status["repeats"]


#from the phrase and number of repeats, construct our array
# e.g. Boston, Boston, Boston, Ivory, Ivory, Ivory, Sweden, Sweden, Sweden
@enrollmentPhrase = []
@phrase.each do |word|
  for i in 1..@repeats
    @enrollmentPhrase << word
  end
end

#use the provided Analysis API to retrieve our phrase endpoints
@analysis = Knurld::Analysis.new({:audioUrl => "https://dl.dropboxusercontent.com/s/ii4qa4vi8r3p4nt/6386420494.wav?dl=0", :num_words => @enrollmentPhrase.length})
@intervals = []

#create pairing of each phrase to intervals, e.g. {"phrase":"boston", "begin":172, "end":839}
@analysis.results["intervals"].each_with_index do |interval, index|
  interval['phrase'] = @enrollmentPhrase[index]
  @intervals << interval
end

#now, enroll our consumer.
@enrollment.populate("https://dl.dropboxusercontent.com/s/ii4qa4vi8r3p4nt/6386420494.wav?dl=0", @intervals)

#now that the consumer is enrolled, we can actually authenticate them using their voice!
sleep 5 #let the enrollment populate

#perform an Analysis on the audio to be verified
@verificationAnalysis = Knurld::Analysis.new({:audioUrl => "https://dl.dropboxusercontent.com/s/tgm52upwbymzgfc/bostonivorysweden.wav?dl=0", :num_words => 3})

#pair them once more
@verificationIntervals = []
@verificationPhrase = ["Boston", "Ivory", "Sweden"]

@verificationAnalysis.results["intervals"].each_with_index do |interval, index|
  interval['phrase'] = @verificationPhrase[index]
  @verificationIntervals << interval
end

@verification = Knurld::Verification.new({:appmodel => @appmodel, :consumer => @consumer})
#**NOTE:** This particular while loop exists solely for demonstration purposes
#it continually creates new verifications until we get one that requires the pre-recorded verification phrase.
#This is NOT needed in actual usage!
#Normally, you would retrieve the verification.status["phrase"] and prompt the user to record it
while @verification.status["phrases"] != ["Boston", "Ivory", "Sweden"]
  @verification = Knurld::Verification.new({:appmodel => @appmodel, :consumer => @consumer})
end

#perform our verification!
@verification.verify("https://dl.dropboxusercontent.com/s/tgm52upwbymzgfc/bostonivorysweden.wav?dl=0", @verificationIntervals)

#retrieve verification status
@verification.status # => true
```

Documentation can be generated by executing command `yard` in the root directory.

## TODO
1. Provide various shortcut methods to simplify API usage
2. Improve documentation

## Development

After checking out the repo, run `bin/setup` to install dependencies. Then, run `rake spec` to run the tests. You can also run `bin/console` for an interactive prompt that will allow you to experiment.

To install this gem onto your local machine, run `bundle exec rake install`. To release a new version, update the version number in `version.rb`, and then run `bundle exec rake release`, which will create a git tag for the version, push git commits and tags, and push the `.gem` file to [rubygems.org](https://rubygems.org).

## Contributing

Bug reports and pull requests are welcome on GitHub at https://github.com/ianseyer/knurld-ruby-sdk. This project is intended to be a safe, welcoming space for collaboration, and contributors are expected to adhere to the [Contributor Covenant](http://contributor-covenant.org) code of conduct.


## License

The gem is available as open source under the terms of the [MIT License](http://opensource.org/licenses/MIT).
